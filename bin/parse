#!/bin/env python3

import re
import textwrap

TEMPLATE="""---
By: Han Shan
Source:
  URL: "http://www.eyeofchan.org/special-features/han-shan/\\
    560-hanshanmaxims.html"
  Locus:
    Date: 19 June 2009
    Section: {0}
---
{1}
"""

fin = open("tmp/han-shan.txt", "r")

chapter = 0
body = ""


def write_body(chapter, body):

    fout = open("tmp/verses/" + str(chapter), "w")
    fout.write(TEMPLATE.format( chapter, body.strip()))
    fout.close()

for l in fin.readlines():
    x = l.strip()

    is_chapter = re.match("^(\d+)\.$", x)

    if is_chapter and body:
        write_body(chapter, body)
        chapter = is_chapter.group(1)
        body = ""
    
    if is_chapter and not body:
        chapter = is_chapter.group(1)
        
    else:
        fixed_body = ""
        words = x.split()
        if len(words) > 0 and re.match("^[A-Z][A-Z]+", x):
            words[0] = words[0].capitalize()
            fixed_body = ' '.join(words)
        else:
            fixed_body = x.strip()

        fixed_body = fixed_body.replace(":", "ï¼š")
        #body += textwrap.fill(fixed_body, 75, subsequent_indent=' ') + "\n"
        body += textwrap.fill(fixed_body, 75) + "\n"

write_body(chapter, body)
