#!/bin/env python3

import re
import textwrap

TEMPLATE="""---
By: Lao Tzu
Source:
  URL: "https://web.archive.org/web/20140511202128/\\
    http://my.pclink.com:80/~allchin/tao/contents.htm"
  Locus:
    Date: 20 August 2017
    Chapter: {0}
  Copyright: 2002
  Translator: Douglas Allchin
---
{1}
"""



def write_body(chapter, body):

    fout = open("tmp/verses/" + str(chapter), "w")
    fout.write(TEMPLATE.format( chapter, body.strip()))
    fout.close()


chapter = 0

for chapter in range(1, 82):
  
  fin = open("tmp/tao-%02g.txt" % (chapter), "r")
  body = None

  for l in fin.readlines():
      x = str(l).strip()

      start = re.match("__", x) 
      end = re.match("© Douglas Allchin 2002",x)

      if start:
        print("START")
        body = " "
        continue

      if end:
        print("END")
        break
 
      if body != None:
          print(x)
          fixed_body = ""
          words = x.split()
          if len(words) > 0 and re.match("^[A-Z][A-Z]+", x):
              words[0] = words[0].capitalize()
              fixed_body = ' '.join(words)
          else:
              fixed_body = x.strip()
  
          fixed_body = fixed_body.replace(":", "：")
          body += textwrap.fill(fixed_body, 75, subsequent_indent=' ') + "\n"
  
  write_body(chapter, body)

